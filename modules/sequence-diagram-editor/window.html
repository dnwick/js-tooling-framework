<html lang="en" class=" webkit chrome mac js gr__localhost">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS Browser Selector JS -->
    <script src="lib/css-browser-selector_0.4.0/css_browser_selector.js"></script>
    <!-- Bootstrap CSS -->
    <link href="lib/bootstrap_v3.3.6/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <!-- Font WSO2 CSS -->
    <link href="lib/font-wso2_1.1.0/css/font-wso2.min.css" rel="stylesheet" type="text/css">
    <!-- Jquery Nanoscroller CSS -->
    <link href="lib/nanoscroller_0.8.7/nanoscroller.css" rel="stylesheet" type="text/css">
    <!-- Theme WSO2 CSS -->
    <link href="lib/theme-wso2_1.0/css/theme-wso2.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="css/custom.css" rel="stylesheet" type="text/css">
    <!-- Common CSS -->
    <link href="css/common.css" rel="stylesheet" type="text/css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="lib/html5shiv_3.7.2/html5shiv.min.js"></script>
    <script src="lib/respond_1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="lib/jquery-ui-1.11.4/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/designer.css">
    <!-- link rel="stylesheet" type="text/css" href="css/app.css" / -->

    <title>Integration Server Tooling</title>

    <style type="text/css" data-gs-id="gridstack-style-29694"></style>
</head>

<body data-gr-c-s-loaded="true" style="cursor: auto;">

    <!-- Modal -->
    <div class="modal fade" id="designerModal" tabindex="-1" role="dialog" aria-labelledby="modalDemo">
        <div class="modal-dialog" role="document">
            <div class="modal-content clearfix">
            </div>
        </div>
    </div>

    <!--Modal for saving the configuration-->
    <div class="modal fade" id="newConfigModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="newConfigModalLabel">Save Integration Flow Configuration</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="location" class="form-control-label">Location</label>
                        <input type="text" class="form-control" id="location">
                    </div>
                    <div class="form-group">
                        <label for="configName" class="form-control-label">Config Name</label>
                        <input class="form-control" id="configName">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="newConfiguration()" data-dismiss="modal">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- header -->
    <header class="header header-default">
        <div class="container-fluid">
            <div class="pull-left brand float-remove-xs text-center-xs">
                <a href="#">
                    <img src="lib/theme-wso2_1.0/images/logo-inverse.svg" alt="WSO2" title="WSO2" class="logo">
                    <h1>Integration Server Tooling</h1>
                </a>
            </div>
            <div class="pull-right auth float-remove-xs text-center-xs">
            </div>
        </div>
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="main-navbar">
                    <ul class="nav navbar-nav">
                        <li><a href="#" data-toggle="modal" data-target="#newConfigModal">New<span class="sr-only">(current)</span></a></li>
                        <li><a href="#" onclick="saveConfiguration()">Save</a></li>
                    </ul>
                </div><!-- /.navbar-collapse -->
            </div><!-- /.container-fluid -->
        </nav>
    </header>

    <!-- #page-content-wrapper -->
    <div class="page-content-wrapper fixed" style="padding-left: 0px;">

        <!-- .left-sidebar-sub -->
        <div class="sidebar-wrapper sidebar-nav sidebar-nav-sub" id="left-sidebar-sub" data-side="left" data-width="250" data-offset-left="305"
            style="display: none; left: -555px;">
            <div class="nano">
                <div class="nano-content" tabindex="0">
                    <button class="btn btn-default close-handle" data-handle="close" data-toggle="sidebar" data-target="#left-sidebar-sub" aria-expanded="true"
                        rel="createPage"><i class="fw fw-cancel"></i></button>
                </div>
                <div class="nano-pane" style="display: none;">
                    <div class="nano-slider" style="height: 278px; transform: translate(0px, 0px);"></div>
                </div>
            </div>
        </div>

        <!-- page content -->
        <div class="container-fluid body-wrapper">
            <div class="page-content">
                <ul class="nav nav-tabs" id="designer-view-mode">
                    <li role="dashboard-view" data-view-mode="default" class="active">
                        <a href="#designViewTab" aria-controls="defaultDashboardView" role="tab" data-toggle="tab">Design View</a>
                    </li>
                    <li role="dashboard-view" data-view-mode="anon" class="">
                        <a href="#sourceViewTab" aria-controls="anonymousDashboardView" role="tab" data-toggle="tab">Source View</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div id="designViewTab" class="tab-pane fade in active">
                        <iframe id="iframe1" src="design-view.html"></iframe>
                    </div>
                    <div id="sourceViewTab" class="tab-pane fade">
                        <iframe id="iframe2" src="source-view.html"></iframe>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="alert alert-success alert-dismissable" id="successAlert" style="display: none; position: absolute; top: 50px; right: 50px; width: 400px">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        Configuration Saved Successfully!!
    </div>
    <div class="alert alert-danger alert-dismissable" id="failAlert" style="display: none; position: absolute; top: 50px; right: 50px; width: 400px">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        Configuration saving Failed!!
    </div>
    <!-- /#page-content-wrapper -->

    <!-- footer -->
    <footer class="footer">
        <div class="container-fluid">
            <p>WSO2 Integration Server Tooling v0.0.1 | Â© <script>document.write(new Date().getFullYear());</script>
                <a href="http://wso2.com/" target="_blank"><i class="icon fw fw-wso2"></i> Inc</a>.</p>
        </div>
    </footer>

    <!-- Jquery/Jquery UI JS -->
    <script src="lib/jquery_1.11.0/jquery-1.11.3.min.js"></script>
    <script src="lib/jquery-ui-1.11.4/jquery-ui.min.js"></script>

    <script>
		$("iframe").css("height", $(window).height() - 40 + "px");
		window.onresize = function() {
			$("iframe").css("height", $(window).height() - 40 + "px");
		}
	</script>

    <script>
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            var target = $(e.target).attr("href"); // activated tab
            // If the changed tab is the source view tab, we need to trigger the source generation in the design view
            // Fires the event message to the design view
            // Design view will listen to the event and generate the source from the design
            if (target == "#sourceViewTab") {
                var DesignIFrame = document.getElementById("iframe1").contentWindow;
                DesignIFrame.postMessage("Hello","*");
            }
        })
    </script>


    <script>
        // Listens to the event messages fired by the two children iframes (Source-view and the diagram-view)
        var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
        var eventer = window[eventMethod];
        var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
        var saveConfig = false;
        var configLocation = undefined;
        var configFileName = undefined;

        // Listen to message
        eventer(messageEvent,function(e) {
            if (saveConfig) {
                var config = '@Path ("/stock")\n' +
                        '@Source (protocol="http", host="localhost", port=8080)\n' +
                        '@Api (tags = {"stock_info","stock_update"}, description = "Rest api for do operations on admin", produces = MediaType.APPLICATION_JSON)\n' +
                        'package com.sample;\n\n';
                config += e.data;
                var payload = "location=" + (btoa(configLocation.value + "/" + configFileName.value)) + "&config=" + (btoa(config));

                $.ajax({
                    url:"http://localhost:8080/utility/saveconfig",
                    type:"POST",
                    data:payload,
                    contentType:"text/plain; charset=utf-8",
                    async:false,
                    success: function(data, textStatus, xhr){
                        if (xhr.status == 200) {
                            $('#successAlert').show();
                            $("#successAlert").fadeTo(4000, 500).slideUp(500, function() {
                                $("#successAlert").slideUp(500);
                            });
                        } else {
                            $('#failAlert').show();
                            $("#failAlert").fadeTo(4000, 500).slideUp(500, function() {
                                $("#failAlert").slideUp(500);
                            });
                        }

                    }
                });
                saveConfig = false;
            } else {
                var SourceIFrame = document.getElementById("iframe2").contentWindow;
                SourceIFrame.postMessage(e.data, "*");
            }
        },false);

        function saveConfiguration() {
            saveConfig = true;
            var DesignIFrame = document.getElementById("iframe1").contentWindow;
            DesignIFrame.postMessage("save-config","*");
        }

        function newConfiguration() {
            var SourceIFrame = document.getElementById("iframe1").contentWindow;
            SourceIFrame.postMessage("new-config", "*");
            configLocation = document.getElementById("location");
            configFileName = document.getElementById("configName");
        }
    </script>

    <!-- Bootstrap JS -->
    <script src="lib/bootstrap_v3.3.6/js/bootstrap.min.js"></script>

    <!-- Jquery Nanoscroller JS -->
    <script src="lib/nanoscroller_0.8.7/jquery.nanoscroller.min.js"></script>

    <!-- Theme WSO2 JS -->
    <script src="lib/theme-wso2_1.0/js/theme-wso2.js"></script>

    <script src="lib/underscore-1.8.3/underscore-min.js"></script>

    <script src="js/jquery.noty.packaged.min.js"></script>
    <script src="js/jquery.simulate.js"></script>
    <script src="js/ues.js"></script>
    <script src="js/ues-store.js"></script>
    <script src="js/designer.js"></script>
    <script src="js/wso2-noty-theme.js"></script>
</body>

</html>